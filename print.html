<!DOCTYPE HTML>
<html lang="zh-cn" class="sidebar-visible no-js rust">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>家中古词</title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "rust";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">table of content</a></li><li class="chapter-item expanded affix "><li class="part-title">Note</li><li class="chapter-item expanded "><a href="toki-pona-dict.html">toki-pona-dict</a></li><li class="chapter-item expanded "><a href="codewars-is-prime.html">codevars-is-prime</a></li><li class="chapter-item expanded "><a href="ssh-rsa.html">ssh-rsa</a></li><li class="chapter-item expanded "><a href="cmake-cheatsheet.html">cmake-cheatsheet</a></li><li class="chapter-item expanded "><a href="cpp11-call-once-throw-error.html">cpp11-call-once-throw-error</a></li><li class="chapter-item expanded "><a href="cryptsetup.html">cryptsetup</a></li><li class="chapter-item expanded "><div>leveldb</div></li><li class="chapter-item expanded "><a href="micro-editor.html">micro-editor</a></li><li class="chapter-item expanded "><a href="packages.html">packages</a></li><li class="chapter-item expanded "><a href="pip-find-local-archives.html">pip-find-local-archives</a></li><li class="chapter-item expanded "><a href="rst-tools.html">rst-tools</a></li><li class="chapter-item expanded "><div>rust-deref</div></li><li class="chapter-item expanded "><a href="rust-getopt.html">rust-getopt</a></li><li class="chapter-item expanded "><a href="switchy-omega-auto-switch.html">switchy-omega-auto-switch</a></li><li class="chapter-item expanded "><a href="systemd-template.html">systemd-template</a></li><li class="chapter-item expanded "><a href="tar-backup.html">tar-backup</a></li><li class="chapter-item expanded "><a href="word-list.html">word-list</a></li><li class="chapter-item expanded "><a href="zola-blog.html">zola-blog</a></li><li class="chapter-item expanded "><a href="ssh-key-password.html">ssh-key-password</a></li><li class="chapter-item expanded "><a href="libflow-with-header.html">libflow-with-header</a></li><li class="chapter-item expanded affix "><li class="part-title">Journal</li><li class="chapter-item expanded "><div>2022</div></li><li class="chapter-item expanded "><div>2021</div></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">家中古词</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        

                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="家中古词zst"><a class="header" href="#家中古词zst">家中古词.zst</a></h1>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="toki-pona"><a class="header" href="#toki-pona">toki pona</a></h1>
<h2 id="nimi"><a class="header" href="#nimi">nimi</a></h2>
<ul>
<li>jan Robert：叫 Robert 的人。</li>
<li>ma Robert：叫 Robert 的地方。</li>
</ul>
<h2 id="pi"><a class="header" href="#pi">pi</a></h2>
<p>有多个修饰词修饰一个词的时候，有时候不会出现问题：</p>
<ul>
<li>ma suli 大地方</li>
<li>ma suli pona 又大又好的地方</li>
</ul>
<p>但有时候比较麻烦：</p>
<ul>
<li>ilo kalama suli</li>
<li>ilo pi kalama suli</li>
</ul>
<p>ilo kalama 字面是声音物，延伸为乐器，加上 suli 修饰，也就是说大件乐器。但 suli
也可以修饰 kalama 表示大声，大声修饰物，则不是乐器，而是噪音很大的工具。</p>
<p>为了消除这种歧义，默认连续修饰关系都是向前结合：</p>
<blockquote>
<p>A B C D</p>
</blockquote>
<p>表示</p>
<blockquote>
<p>((A B) C) D</p>
</blockquote>
<p>即 B 修饰 A，C 修饰 (B A) 整体，D 修饰 ((A B) C) 整体。因此 ilo kalama suli 确
实表示大件乐器。</p>
<p>同时使用 pi 介词打断结合。</p>
<blockquote>
<p>A B pi C D</p>
</blockquote>
<p>表示：</p>
<blockquote>
<p>(A B) (C D)</p>
</blockquote>
<p>即 B 修饰 A，C 修饰 D，(C D) 修饰 (A B)。这时 ilo pi kalama suli 是噪音大的工具
。</p>
<p>例子：</p>
<ul>
<li>kulupu（组、社区） lipu（书） suli：大型图书俱乐部</li>
<li>kulupu pi lipu suli：一堆大开本的书</li>
</ul>
<h2 id="kulupu-nimi"><a class="header" href="#kulupu-nimi">kulupu nimi</a></h2>
<table><thead><tr><th>单词</th><th>解释</th></tr></thead><tbody>
<tr><td>a</td><td>强调、感情、确认</td></tr>
<tr><td>akesi</td><td>两栖类、爬行类、不可爱的动物</td></tr>
<tr><td>ala</td><td>无、非、没有、零</td></tr>
<tr><td>alasa</td><td>狩猎、觅食</td></tr>
<tr><td>ale</td><td>所有、全部、无数的、丰富、生活、宇宙、100</td></tr>
<tr><td>ali</td><td>所有、全部、无数的、丰富、生活、宇宙、100</td></tr>
<tr><td>jaki</td><td>不干净的，粗野的</td></tr>
<tr><td>jelo</td><td>黄色</td></tr>
<tr><td>kulupu</td><td>组，社区</td></tr>
<tr><td>laso</td><td>蓝色</td></tr>
<tr><td>lawa</td><td>头</td></tr>
<tr><td>linja</td><td>绳子，头发</td></tr>
<tr><td>lipu</td><td>书</td></tr>
<tr><td>loje</td><td>红色</td></tr>
<tr><td>luka</td><td>手、胳膊</td></tr>
<tr><td>mama</td><td>父母、祖先、创造者</td></tr>
<tr><td>mi</td><td>我</td></tr>
<tr><td>nimi</td><td>名字、单词</td></tr>
<tr><td>noka</td><td>脚、腿</td></tr>
<tr><td>ona</td><td>他、她、它</td></tr>
<tr><td>open</td><td>开始</td></tr>
<tr><td>pan</td><td>谷物为原料的食物</td></tr>
<tr><td>pimeja</td><td>暗色</td></tr>
<tr><td>sina</td><td>你</td></tr>
<tr><td>tenpo</td><td>时间，持续，永远</td></tr>
<tr><td>walo</td><td>亮色</td></tr>
</tbody></table>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="codewars---isprime"><a class="header" href="#codewars---isprime">CodeWars - IsPrime</a></h1>
<h2 id="is-a-number-prime"><a class="header" href="#is-a-number-prime">Is a number prime?</a></h2>
<pre><code>IsPrime :: Integer -&gt; Bool
</code></pre>
<p>判断一个整数是否是整数。假设整数是 N，这个题目只需要 N 的 1/2 次方程度的复杂度
就可以了。</p>
<h2 id="解答"><a class="header" href="#解答">解答</a></h2>
<p>当 x 小于等于 1 时为假，否则检查不大于根号 N 的数中是否有 N 的因子即可。后面这
个过程是迭代过程，可以列表推导来完成：求出 2 到根号 N 中 N 的因子的列表，再判断
这个列表是不是空的。而因为懒求值的性质，这个过程并没有很多 overhead。</p>
<pre><code>isPrime :: Integer -&gt; Bool
isPrime x
  | x &lt;= 1    = False
  | otherwise = null [d | d &lt;- [2..iSqrt x], (mod x d) == 0]

iSqrt :: Integer -&gt; Integer
iSqrt = floor . sqrt . fromInteger
</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="没有共同签名"><a class="header" href="#没有共同签名">没有共同签名</a></h1>
<p>我发现我没办法用 ssh 密钥推送和获取 gitee 上的版本库了。当然 https 的校验没有问题，所以不是我账户有什么毛病。我想起可以用 GIT_SSH 告诉 git 使用脚本代替 ssh 命令连接到版本库。我就用它来看看 ssh 的情况：</p>
<pre><code>#!/usr/bin/env bash

# git-ssh
exec ssh -v &quot;$@&quot;
</code></pre>
<p>然后：</p>
<pre><code>GIT_SSH=./git-ssh git clone {some_repo}
</code></pre>
<p>这时 ssh 就打印出了调试信息：</p>
<pre><code>{其他信息}
debug1: Authentications that can continue: publickey
debug1: Next authentication method: publickey
debug1: Offering public key: {密钥文件} RSA SHA256:{校验和} explicit
debug1: send_pubkey_test: no mutual signature algorithm
debug1: No more authentication methods to try.
git@gitee.com: Permission denied (publickey).
fatal: 无法读取远程仓库。
</code></pre>
<p>从字面上看，ssh 说「没有共同的签名算法」。查看上面对应的 {密钥文件} 对应的公钥，它的开头是 ssh-rsa，这表示它是基于 SHA-1 哈系的 RSA 密钥，而 SHA-1 已经不再安全了。这个错误可能是 gitee 或者我本机的某一端拒绝使用 ssh-rsa 这个算法了。</p>
<p>因此我也不必再调查是谁拒绝了这个算法，只需要换个更好的算法即可：</p>
<pre><code>ssh-keygen -t ed25519 -f {新密钥文件} -C {我的邮箱}
</code></pre>
<ul>
<li>-t 表示密钥类型（type），ed25519 是一种基于椭圆曲线的加密算法。</li>
<li>-f 表示输出密钥到这个文件（file）。</li>
<li>-C 表示给密钥加个注释（comment）。</li>
</ul>
<p>可以发现 ed25519 的密钥很短，甚至可以背下来 XD。</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="cmake-速记"><a class="header" href="#cmake-速记">cmake 速记</a></h1>
<h2 id="c-标准"><a class="header" href="#c-标准">C++ 标准</a></h2>
<p>全局设置：</p>
<pre><code>set(CMAKE_CXX_STANDARD 11)
</code></pre>
<p>目标设置：</p>
<pre><code>set_property(TARGET target PROPERTY CXX_STANDARD 14)
</code></pre>
<h2 id="目标不只是库"><a class="header" href="#目标不只是库">目标不只是库</a></h2>
<p>目标除了是库的名字，还包含库的编译和链接参数，以及依赖的编译和链接参数。</p>
<p>全局地增加头文件路径：</p>
<pre><code>include_directories(${INCLUDE_PATH})
</code></pre>
<p>这样会使得所有目标的头文件搜索都增加此路径，除非这是 SDK 提供的头文件路径，否则这样做是结构不良的。应该使用：</p>
<pre><code>target_include_directories(${TARGET} ${SCOPE} ${INCLUDE_PATH})
</code></pre>
<p>这样只会在此目标编译时查找这个路径。</p>
<p>类似的 <code>link_directories</code> 比 <code>include_directories</code> 更加危险，因为头文件路径查找混乱往往是容易发现的，但库查找失败往往是非常隐蔽的。在多数时候都应该用 <code>target_link_directories</code> 代替。</p>
<p>这个命令只有在被链接的是库的名字时才代表链接 C 库，它还可以是一个目标的名字。此时它代表的是此目标依赖对应目标，进而会将依赖目标的公开（PUBLIC）编译属性、路径属性和链接属性传播到被依赖的目标上。达成树形的依赖管理。</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="c11-的-call_once-函数抛出错误"><a class="header" href="#c11-的-call_once-函数抛出错误">C++11 的 call_once 函数抛出错误</a></h1>
<p><a href="https://stackoverflow.com/questions/51584960/stdcall-once-throws-stdsystem-error-unknown-error-1">https://stackoverflow.com/questions/51584960/stdcall-once-throws-stdsystem-error-unknown-error-1</a></p>
<p>C++11 的 call-once 函数可以用来保证一个函数（或者其他可调用对象）只运行一次。</p>
<pre><code>call_once(std::once_flag const &amp;, Callable &amp;&amp;, Arguments&amp;&amp; ...);
</code></pre>
<p>调用的时候需要保证 once-flag 在不同的调用之间共享一个实例。</p>
<p>这个函数是线程安全的，需要系统线程库，例如 pthread。但如果使用了它的目标不链接，往往也可能不会出现链接问题。而是会在运行时出现 system-error。</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="cryptsetup"><a class="header" href="#cryptsetup">cryptsetup</a></h1>
<h2 id="wsl2"><a class="header" href="#wsl2">WSL2</a></h2>
<p>首先升级到 Window 11，切换到管理员模式的 PowerShell，插入磁盘，查看磁盘 ID：</p>
<pre><code>GET-CimInstance -query &quot;SELECT * from Win32_DiskDrive&quot;
</code></pre>
<p>第一行的 <code>\\.\PHYSICALDRIVE*</code> 是此磁盘的 ID，挂载到 WSL2。</p>
<pre><code>wsl --mount ${ID} --bare
</code></pre>
<p>因为这个磁盘里没有 Linux 能直接认识的操作系统，所以需要用 --bare 要求它只挂载裸设备。如果顺利，Linux 的终端中就可以看到这个磁盘设备，例如 /dev/sdc 和 /dev/sdc1。</p>
<p>参考：</p>
<ul>
<li><a href="https://devblogs.microsoft.com/commandline/servicing-the-windows-subsystem-for-linux-wsl-2-linux-kernel/">https://devblogs.microsoft.com/commandline/servicing-the-windows-subsystem-for-linux-wsl-2-linux-kernel/</a></li>
<li><a href="https://docs.microsoft.com/zh-cn/windows/wsl/wsl2-mount-disk">https://docs.microsoft.com/zh-cn/windows/wsl/wsl2-mount-disk</a></li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="micro-编辑器"><a class="header" href="#micro-编辑器">micro 编辑器</a></h1>
<h2 id="存活"><a class="header" href="#存活">存活</a></h2>
<p>micro {FILE} 打开文件，C-q 退出，C-s 保存。C-e 打开命令模式，help 命令打开帮助。</p>
<p>帮助文档会显示在另一个窗口，同时光标会跳转过去，C-w 跳转光标到原来的窗口，再按跳转回去。按方向键移动光标，阅读帮助。</p>
<h2 id="帮助摘要"><a class="header" href="#帮助摘要">帮助摘要</a></h2>
<p>用 help {topic} 查看帮助，topic 有：</p>
<ul>
<li>tutorial</li>
<li>keybindings</li>
<li>defaultkeys</li>
<li>commands</li>
<li>options</li>
<li>plugins</li>
<li>colors</li>
</ul>
<h2 id="教程"><a class="header" href="#教程">教程</a></h2>
<p>这是 help tutorial 的摘要。</p>
<p>配置文件在 ~/.config/micro 里。micro 启动会加载配置文件 settings.json。set 命令会同步修改里面的值。setlocal 则相反，不会修改这个文件。</p>
<p>settings.json 可以用：</p>
<pre><code>{
	&quot;*.rb&quot;: {
		&quot;tabsize&quot;: 2
	}
}
</code></pre>
<p>设置特别文件的选项。bindings.json 是按键绑定配置。bind 命令可以同步修改这个文件。init.lua 文件是 initlua 插件的启动文件。</p>
<h2 id="命令"><a class="header" href="#命令">命令</a></h2>
<p>后缀问号的是可选参数。</p>
<h3 id="按键绑定"><a class="header" href="#按键绑定">按键绑定</a></h3>
<ul>
<li>bind {key} {action}</li>
<li>showkey {key}</li>
</ul>
<h3 id="编辑"><a class="header" href="#编辑">编辑</a></h3>
<ul>
<li>replace {search} {value} {flag}?
<ul>
<li>-a 替换所有</li>
<li>-l 字面替换（literal）而不是正则表达式替换</li>
</ul>
</li>
<li>replaceall {search} {value}</li>
<li>retab：根据选项 tabtospaces，将 tab 和空格之间转换。</li>
<li>textfilter {command}...：把当前选择的文本用命令过滤。</li>
</ul>
<h3 id="文件"><a class="header" href="#文件">文件</a></h3>
<ul>
<li>save {file}?</li>
<li>reload</li>
</ul>
<h3 id="插件"><a class="header" href="#插件">插件</a></h3>
<ul>
<li>plugin list</li>
<li>plugin install {plugin}</li>
<li>plugin remove {plugin}</li>
<li>plugin update {plugin}</li>
<li>plugin avaliable {plugin}</li>
</ul>
<h3 id="选项"><a class="header" href="#选项">选项</a></h3>
<ul>
<li>set {option} {value}</li>
<li>setlocal {option} {value}</li>
<li>show {option}</li>
<li>reset {option}</li>
</ul>
<h3 id="窗格"><a class="header" href="#窗格">窗格</a></h3>
<ul>
<li>vsplit {file}</li>
<li>hsplit {file}</li>
<li>tab {file}</li>
<li>tabmove {n}</li>
<li>tabmove +{n}</li>
<li>tabmove -{n}</li>
<li>tabswitch {tab}</li>
<li>quit</li>
</ul>
<h3 id="命令-1"><a class="header" href="#命令-1">命令</a></h3>
<ul>
<li>run {command}...：后台运行 shell 命令，命令输出会在运行结束后（连接成一行）展示在最下面。</li>
<li>textfilter {command}...：把当前选择的文本用命令过滤。</li>
<li>term {exec}?</li>
</ul>
<h3 id="其他"><a class="header" href="#其他">其他</a></h3>
<ul>
<li>help {topic}?</li>
<li>log：打开历史命令</li>
<li>cd {path}</li>
<li>pwd</li>
<li>raw：打开一个文件，显示所有按键。可以帮助用户确定 micro 捕获了哪些按键（有些快捷键会被终端模拟器或者 shell 捕获）。</li>
</ul>
<h3 id="插件提供"><a class="header" href="#插件提供">插件提供</a></h3>
<ul>
<li>lint：默认插件提供，检查当前文件。</li>
<li>comment：默认插件提供，自动注释。</li>
</ul>
<h2 id="按键"><a class="header" href="#按键">按键</a></h2>
<h3 id="导航"><a class="header" href="#导航">导航</a></h3>
<p>Alt-{ 和 Alt-} 段移动，Ctrl-l 移动到某行。Ctrl-w 在窗格之间移动。Alt-a 和 Alt-e 移动到行开始和结尾。Alt-f 和 Alt-b 以单词为单位移动。</p>
<h3 id="标签页"><a class="header" href="#标签页">标签页</a></h3>
<p>Ctrl-t 打开标签页；Alt-, 和 Alt-. 在标签页之间移动。</p>
<h3 id="查找"><a class="header" href="#查找">查找</a></h3>
<p>Ctrl-f 查找；Ctrl-n 和 Ctrl-p 在查找到的目标之间移动。</p>
<h3 id="文件-1"><a class="header" href="#文件-1">文件</a></h3>
<p>Ctrl-q 退出；Ctrl-o 打开新文件；Ctrl-s 保存当前文件。</p>
<h3 id="其他-1"><a class="header" href="#其他-1">其他</a></h3>
<p>Ctrl-z 和 Ctrl-y 是 undo 和 redo。Ctrl-u 录制宏，再按停止录制。Ctrl-j 播放宏。</p>
<p>选中一个单词，或者光标移动到一个词上，按若干次 Alt-n，会同时选中多个当前单词。Alt-Shift 加上下会在当前光标上下新建光标。Alt-c 取消多光标。</p>
<p>Ctrl-g 打开帮助文件，Ctrl-r 打开（关闭）行号。</p>
<h2 id="插件-1"><a class="header" href="#插件-1">插件</a></h2>
<p>~/.config/micro/plug 下的文件夹保存 micro 的插件。插件文件夹里需要有 info.json 文件。</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="packages"><a class="header" href="#packages">Packages</a></h1>
<h2 id="yay"><a class="header" href="#yay">yay</a></h2>
<ul>
<li>acpi</li>
</ul>
<p>ACPI is short for <em>Advanced Configuration and Power Interface</em>. This command will query your battery status.</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="让-pip-查找本地的包"><a class="header" href="#让-pip-查找本地的包">让 pip 查找本地的包</a></h1>
<p>如果你有很多 whl 包，而且还有个 nas 盘用来分享包。可以把 whl 包拷贝到 nas 盘的一个目录里：</p>
<pre><code>cp dist/xxxx.whl /mnt/nas/whl/
</code></pre>
<p>然后用 pip 的 -f, --find-links 选项来在这个目录里找包。</p>
<pre><code>pip -f /mnt/nas/whl xxxx
</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="restructuctedtext-的配套工具"><a class="header" href="#restructuctedtext-的配套工具">reStructuctedText 的配套工具</a></h1>
<p>Rst 是个很好的文档格式。</p>
<p>rst2html 将 Rst 转换成 html：</p>
<pre><code>rst2html source.rst target.html
</code></pre>
<p>如果不怕丑，现在可以把 target.html 挂在个人网站上。</p>
<p>rst2man 将 Rst 转换成 man 程序可以读取的格式，我喜欢用它来在终端里阅读 Rst 文档:</p>
<pre><code>local manfile=$(mktemp)
rst2man source.rst $manfile
man $manfile
</code></pre>
<p>rst2pdf 将 Rst 转换成 pdf，可以用来比较正式地发布给其他人看。不过对中文字体的处理永远是个难题，多半需要你指定样式表才能正确渲染中文:</p>
<pre><code>rst2pdf source.rst target.pdf
rst2pdf -s chinese source.rst target.pdf
</code></pre>
<p>上面的 <code>-s chinese</code> 实际上指明了 ~/.rst2pdf/styles/chinese.style：</p>
<pre><code>{ &quot;styles&quot;: { &quot;base&quot;: { &quot;wordWrap&quot;: &quot;CJK&quot; } }
, &quot;fontsAlias&quot;: { &quot;stdFont&quot;: &quot;Source Han Serif&quot; } }
</code></pre>
<p>这个配置只是示例，不保证成功。</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="rust-的-getopt-库"><a class="header" href="#rust-的-getopt-库">Rust 的 getopt 库</a></h1>
<p>getopt::Parser::new 传入用命令行参数数组和选项定义。Parser 是个迭代器，返回的是一种 Result。利用 Option 在内部值是 Result 的时候有 transpose 方法。所以常见下面的用法：</p>
<pre><code>while let Some(opt) = opts.next().transpose()? {
    // 处理 opt
}
// 没有更多参数了。
</code></pre>
<p>当迭代器返回错误的时候，这段代码会返回此错误。</p>
<p>opt 部分是 getopt::Opt 类型，它不过是 char 和 Option&lt;String&gt; 的元组，表示选项和选项的值（可选）。再根据选项定义处理不同的选项即可。注意参数不足或者未定义选项等错误会在 transpose 处返回，不必在循环中处理，所以选项定义外的分支可以直接调用 unreachable!()。</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="switchy-omega-的自动切换列表"><a class="header" href="#switchy-omega-的自动切换列表">Switchy Omega 的自动切换列表</a></h1>
<ul>
<li>stackoverflow.com 需要 ajax.googleapis.com</li>
</ul>
<pre><code>[SwitchyOmega Conditions]
@with result

*.stackoverflow.com +proxy
*.github.com +proxy
github.com +proxy
docs.python.org +proxy
*.google.com +proxy
*.googleapis.com +proxy

* +direct
</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="systemd-template"><a class="header" href="#systemd-template">systemd-template</a></h1>
<p>Systemd 有种模板功能。如果 service 文件形式是 name@variant.service，那么在一些
位置，例如 ExecStart= 中，可以用 %i 来替代 variant。</p>
<p>例如 ss-local@google.service 里的 ExecStart= 是：</p>
<pre><code>ExecStart=/usr/bin/ss-local -c /etc/ss-local/%i.json
</code></pre>
<p>则实际上服务运行时会启动命令：</p>
<pre><code>/usr/bin/ss-local -c /etc/ss-local/google.json
</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="tar-的增量备份能力"><a class="header" href="#tar-的增量备份能力">tar 的增量备份能力</a></h1>
<p>备份与还原是相对的。设下面的序号是递增的时间点，朴素的备份还原过程是：</p>
<ol>
<li>备份到文件 1，保存当前所有内容。</li>
<li>备份到文件 2，保存当前所有内容。</li>
<li>备份到文件 3，保存当前所有内容。</li>
<li>从备份文件 1 还原到 1 时刻。</li>
<li>从备份文件 2 还原到 2 时刻。</li>
</ol>
<p>增量备份则在保存之间共享重复的部分：</p>
<ol>
<li>备份到文件 1，保存当前所有内容。</li>
<li>备份到文件 2，保存当前与 1 时刻的区别。</li>
<li>备份到文件 3，保存当前与 2 时刻的区别。</li>
<li>从备份文件 1、2、3 还原到 3 时刻。</li>
<li>从备份文件 1、2 还原到 2 时刻。</li>
</ol>
<p>tar 用 -g 选项支持这种过程。</p>
<ul>
<li>
<p>初次备份：</p>
<pre><code>tar -g snapshot -czf backup0.tar.gz backup/
</code></pre>
</li>
<li>
<p>第二次备份：</p>
<pre><code>tar -g snapshot -czf backup1.tar.gz backup/
</code></pre>
</li>
<li>
<p>第三次备份：</p>
<pre><code>tar -g snapshot -czf backup1.tar.gz backup/
</code></pre>
</li>
</ul>
<p>snapshot 是生成的文件列表文件，它一般情况下都很小。还原需要依次解压所有的包。</p>
<p>如果备份的恢复并不需要恢复到除了最新版本之外的历史版本，也就是如下的流程：</p>
<ol>
<li>备份到文件 1，保存当前所有内容。</li>
<li>备份到文件 1，更新当前与之前时刻的区别。</li>
<li>备份到文件 1，更强当前与之前时刻的区别。</li>
<li>从备份文件 1 还原到 3 时刻。</li>
<li>无法还原到 2 时刻。</li>
</ol>
<p>那么可以使用 tar 的 -u 选项。</p>
<ul>
<li>
<p>初次备份：</p>
<pre><code>tar -cv -f backup.tar.gz backup
</code></pre>
</li>
<li>
<p>之后的备份：</p>
<pre><code>tar -uv -f backup.tar.gz backup
</code></pre>
</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><ul>
<li>
<p>menace</p>
<ul>
<li>n. 威胁，危险的人物。</li>
<li>v. （正式）威胁，威吓。</li>
<li>nethack - Exploring The Mezes of Menace</li>
</ul>
</li>
<li>
<p>dungeon</p>
<ul>
<li>n. 土牢，地牢。</li>
<li>Dungeons &amp; Dragons (TM) 龙与地下城</li>
</ul>
</li>
<li>
<p>amulet</p>
<ul>
<li>n. 护身符，辟邪的物品。</li>
<li>Amulet of Yendor</li>
</ul>
</li>
</ul>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="zola-网站生成器"><a class="header" href="#zola-网站生成器">zola 网站生成器</a></h1>
<p>Zola 是个 Rust 程序，但是可以用 snap 安装。它是基于 CommonMark 渲染文章成网站的。渲染过程中使用了 Tera 模板引擎。</p>
<p>这个网站选择了 Zola 的 after-dark 主题。</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="ssh-密钥的密码"><a class="header" href="#ssh-密钥的密码">SSH 密钥的密码</a></h1>
<p>SSH 密钥可以用密码保护起来。在 ssh-keygen 的时候允许输入密码。使用此密钥时需要输入密码解密。</p>
<p>注意这种加密是对私钥的加密，公钥不会发生改变，从而可以将公钥发布给别人，同时定时修改私钥的密码，提高安全性。</p>
<pre><code>ssh-keygen -p [-f keyfile]
</code></pre>
<p>可以修改私钥的密码。</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="发送带头部信息的-libflow-消息包"><a class="header" href="#发送带头部信息的-libflow-消息包">发送带头部信息的 libflow 消息包</a></h1>
<h2 id="背景"><a class="header" href="#背景">背景</a></h2>
<p>libflow 是 zhangqi@minieye.cc 撰写的 IPC 库，基于 websocket 协议。广泛用于我司
传感器数据发送。它的消息格式是 MessagePack，具体来说是包含下列字段的 MessagePack map。</p>
<ul>
<li>time：发送时间。</li>
<li>source：发送者。</li>
<li>topic：消息主题。</li>
<li>data：用户数据。</li>
</ul>
<p>libflow 将上述数据打包成 map，作为 websocket 协议的 Binary 数据发送给订阅者。</p>
<p>在较高版本的 libflow 中，支持设置 sender.serialize 为 raw，这会改变发送时的行为
，只把用户数据作为 websocket Binary 数据发出，而不是 MessagePack 包。</p>
<h2 id="在-libflow-协议基础上增加头信息"><a class="header" href="#在-libflow-协议基础上增加头信息">在 libflow 协议基础上增加头信息</a></h2>
<p>当发送的用户数据是带有头信息的，例如：</p>
<ul>
<li>gtc_tick: 消息对应的传感器时间，单调时钟，从 EPOCH 开始的微秒数，64 位无符号整数。</li>
<li>utc_tick：消息对应的传感器时间，实时时钟，从 EPOCH 开始的微秒数，64 位无符号整数。</li>
</ul>
<p>此外还有消息的「本体」，例如用 protobuf 序列化的某个 protobuf 消息。这种情况下
，平凡的做法是将消息本体和头信息用 MessagePack 打包在一起，即打包下列的 MessagePack map：</p>
<ul>
<li>gtc_tick</li>
<li>utc_tick</li>
<li>data</li>
</ul>
<p>再将此数据传递给 libflow 的发送接口（默认协议）。从而发出的消息具有这样的结构：</p>
<pre><code>&lt;Websocket Binary&gt;
  &lt;MessagePack Map&gt;
    time
    source
    topic
    data
      &lt;MessagePack Map&gt;
        gtc_tick
        utc_tick
        data &lt;Protobuf&gt;
</code></pre>
<p>《传感器发送协议220428》中的第一节将此称作「规范2」。</p>
<h2 id="扩展-libflow-默认协议增加头信息"><a class="header" href="#扩展-libflow-默认协议增加头信息">扩展 libflow 默认协议增加头信息</a></h2>
<p>上述方案，逻辑上使用者需要解开 websocket Binary 中的 MessagePack 包，再将 data
部分作为 MessagePack 解开包，虽然技术上因为 MessagePack 的递归特性可以省去一次
解包，但需要特定的实现来做这件事。</p>
<p>此外，假设从无头部信息的数据开始迭代，这可能导致相关工具发生 breaking 变动。</p>
<p>因此感知组使用另一种方法。在原则上使用 libflow 的 raw 协议，也就要求较高的
libflow 版本。模拟 libflow 默认协议，并增加 extra 部分。</p>
<ul>
<li>time：发送时间。</li>
<li>source：发送者。</li>
<li>topic：消息主题。</li>
<li>data：用户数据。</li>
<li>extra：任意 MessagePack 数据。</li>
</ul>
<p>按照上例，gtc_tick 和 utc_tick 是 MessagePack map，即发出数据有这样的格式：</p>
<pre><code>&lt;Websocket Binary&gt;
  &lt;MessagePack Map&gt;
    time
    source
    topic
    extra
      gtc_tick
      utc_tick
    data &lt;Protobuf&gt;
</code></pre>
<p>它因此可以骗过下游，让下游认为这个消息还是 libflow 默认协议（只要不解析 extra
部分）。</p>
<p>《传感器发送协议220428》中的第一节将此称作「规范1」。</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
